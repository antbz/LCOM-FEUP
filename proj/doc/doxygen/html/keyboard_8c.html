<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LCOM-Ninja: /home/antonio/FEUP/2_ano/1_sem/LCOM/MINIX-LCOM/shared/proj/src/src/keyboard.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LCOM-Ninja
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_98cdb10f369f6a3b9149e010b312bf5d.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">keyboard.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;lcom/lcf.h&gt;</code><br />
<code>#include &quot;<a class="el" href="keyboard_8h_source.html">../headers/keyboard.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for keyboard.c:</div>
<div class="dyncontent">
<div class="center"><img src="keyboard_8c__incl.png" border="0" usemap="#_2home_2antonio_2FEUP_22__ano_21__sem_2LCOM_2MINIX-LCOM_2shared_2proj_2src_2src_2keyboard_8c" alt=""/></div>
<map name="_2home_2antonio_2FEUP_22__ano_21__sem_2LCOM_2MINIX-LCOM_2shared_2proj_2src_2src_2keyboard_8c" id="_2home_2antonio_2FEUP_22__ano_21__sem_2LCOM_2MINIX-LCOM_2shared_2proj_2src_2src_2keyboard_8c">
<area shape="rect" id="node3" href="keyboard_8h.html" title="Functions to interface with the PC&#39;s keyboard controller. " alt="" coords="135,124,283,151"/>
<area shape="rect" id="node7" href="kbd__defs_8h.html" title="kbd_defs.h" alt="" coords="397,199,484,225"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a15cd0b00a8f834d25bbd39ea9c0519ea"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#a15cd0b00a8f834d25bbd39ea9c0519ea">subscribe_kbc</a> (uint8_t *bit_no)</td></tr>
<tr class="memdesc:a15cd0b00a8f834d25bbd39ea9c0519ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscribes keyboard's interrupts.  <a href="#a15cd0b00a8f834d25bbd39ea9c0519ea">More...</a><br /></td></tr>
<tr class="separator:a15cd0b00a8f834d25bbd39ea9c0519ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73757077133b7fe559d036ce133bcda5"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#a73757077133b7fe559d036ce133bcda5">unsubscribe_kbc</a> ()</td></tr>
<tr class="memdesc:a73757077133b7fe559d036ce133bcda5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsubscribes keyboard's interrupts.  <a href="#a73757077133b7fe559d036ce133bcda5">More...</a><br /></td></tr>
<tr class="separator:a73757077133b7fe559d036ce133bcda5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d17da4ed398d7cd4b3462ec31585cce"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#a9d17da4ed398d7cd4b3462ec31585cce">kbd_get_status_byte</a> (bool *preserve)</td></tr>
<tr class="memdesc:a9d17da4ed398d7cd4b3462ec31585cce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the KBC state.  <a href="#a9d17da4ed398d7cd4b3462ec31585cce">More...</a><br /></td></tr>
<tr class="separator:a9d17da4ed398d7cd4b3462ec31585cce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5761bd4aad91ac1d68916ad88f583d9f"><td class="memItemLeft" align="right" valign="top">void()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#a5761bd4aad91ac1d68916ad88f583d9f">kbc_ih</a> (void)</td></tr>
<tr class="separator:a5761bd4aad91ac1d68916ad88f583d9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf925ef53bcf49cda319a48d33b825e4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#acf925ef53bcf49cda319a48d33b825e4">kbc_cmd_read</a> (uint8_t *out)</td></tr>
<tr class="memdesc:acf925ef53bcf49cda319a48d33b825e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads command byte.  <a href="#acf925ef53bcf49cda319a48d33b825e4">More...</a><br /></td></tr>
<tr class="separator:acf925ef53bcf49cda319a48d33b825e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9878df655d523f5c58423d305a912336"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#a9878df655d523f5c58423d305a912336">kbc_cmd_write</a> (uint8_t command)</td></tr>
<tr class="memdesc:a9878df655d523f5c58423d305a912336"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes command.  <a href="#a9878df655d523f5c58423d305a912336">More...</a><br /></td></tr>
<tr class="separator:a9878df655d523f5c58423d305a912336"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3f07434f2f0a6a358f8342924ceb3c74"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#a3f07434f2f0a6a358f8342924ceb3c74">hookid</a> = 1</td></tr>
<tr class="separator:a3f07434f2f0a6a358f8342924ceb3c74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cc545950661d96524585c500b3b68d1"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#a1cc545950661d96524585c500b3b68d1">data</a> [2]</td></tr>
<tr class="separator:a1cc545950661d96524585c500b3b68d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa02e483eb21e700531ca2ddf2508d189"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#aa02e483eb21e700531ca2ddf2508d189">kbd_valid</a></td></tr>
<tr class="separator:aa02e483eb21e700531ca2ddf2508d189"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78ab698245ea1f18f4b66d2cefbfa1f1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="keyboard_8c.html#a78ab698245ea1f18f4b66d2cefbfa1f1">two_byte_code</a></td></tr>
<tr class="separator:a78ab698245ea1f18f4b66d2cefbfa1f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="acf925ef53bcf49cda319a48d33b825e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf925ef53bcf49cda319a48d33b825e4">&#9670;&nbsp;</a></span>kbc_cmd_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kbc_cmd_read </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>out</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads command byte. </p>
<p>Writes KBC command 0x20 to port 0x64, reading the byte in the output buffer to uint8_t* out.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>pointer to where to store the command byte read. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="keyboard_8c_acf925ef53bcf49cda319a48d33b825e4_cgraph.png" border="0" usemap="#keyboard_8c_acf925ef53bcf49cda319a48d33b825e4_cgraph" alt=""/></div>
<map name="keyboard_8c_acf925ef53bcf49cda319a48d33b825e4_cgraph" id="keyboard_8c_acf925ef53bcf49cda319a48d33b825e4_cgraph">
<area shape="rect" id="node2" href="utils_8c.html#a79a031a8611f5b2d6afa4158e92b0fb4" title="util_sys_inb" alt="" coords="160,5,251,32"/>
</map>
</div>

</div>
</div>
<a id="a9878df655d523f5c58423d305a912336"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9878df655d523f5c58423d305a912336">&#9670;&nbsp;</a></span>kbc_cmd_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kbc_cmd_write </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>command</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes command. </p>
<p>Writes KBC command 0x60 to port 0x64, and then writes the new value of the command byte to port 0x60.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">command</td><td>command byte to be written. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>

</div>
</div>
<a id="a5761bd4aad91ac1d68916ad88f583d9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5761bd4aad91ac1d68916ad88f583d9f">&#9670;&nbsp;</a></span>kbc_ih()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void() kbc_ih </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="keyboard_8c_a5761bd4aad91ac1d68916ad88f583d9f_cgraph.png" border="0" usemap="#keyboard_8c_a5761bd4aad91ac1d68916ad88f583d9f_cgraph" alt=""/></div>
<map name="keyboard_8c_a5761bd4aad91ac1d68916ad88f583d9f_cgraph" id="keyboard_8c_a5761bd4aad91ac1d68916ad88f583d9f_cgraph">
<area shape="rect" id="node2" href="keyboard_8c.html#a9d17da4ed398d7cd4b3462ec31585cce" title="Reads the KBC state. " alt="" coords="113,5,256,32"/>
<area shape="rect" id="node3" href="utils_8c.html#a79a031a8611f5b2d6afa4158e92b0fb4" title="util_sys_inb" alt="" coords="304,31,395,57"/>
</map>
</div>

</div>
</div>
<a id="a9d17da4ed398d7cd4b3462ec31585cce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d17da4ed398d7cd4b3462ec31585cce">&#9670;&nbsp;</a></span>kbd_get_status_byte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kbd_get_status_byte </td>
          <td>(</td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>preserve</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads the KBC state. </p>
<p>Reads the byte in the status register (port 0x64) and checks if it's valid. Discards the value read if the parity, timeout or aux bits are set and checks the obf bit to see if there is data available for reading from the buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">preserve</td><td>bool that gets if what's read is in a valid state or not </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the operation was successful, 1 otherwise </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="keyboard_8c_a9d17da4ed398d7cd4b3462ec31585cce_cgraph.png" border="0" usemap="#keyboard_8c_a9d17da4ed398d7cd4b3462ec31585cce_cgraph" alt=""/></div>
<map name="keyboard_8c_a9d17da4ed398d7cd4b3462ec31585cce_cgraph" id="keyboard_8c_a9d17da4ed398d7cd4b3462ec31585cce_cgraph">
<area shape="rect" id="node2" href="utils_8c.html#a79a031a8611f5b2d6afa4158e92b0fb4" title="util_sys_inb" alt="" coords="196,5,287,32"/>
</map>
</div>

</div>
</div>
<a id="a15cd0b00a8f834d25bbd39ea9c0519ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a15cd0b00a8f834d25bbd39ea9c0519ea">&#9670;&nbsp;</a></span>subscribe_kbc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() subscribe_kbc </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>bit_no</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subscribes keyboard's interrupts. </p>
<p>Subscribes keyboard's interrupt notifications using sys_irqsetpolicy().</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bit_no</td><td>pointer to the hook_id returned by the kernel in sys_irqsetpolicy(). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the operation was successful, 1 otherwise </dd></dl>

</div>
</div>
<a id="a73757077133b7fe559d036ce133bcda5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a73757077133b7fe559d036ce133bcda5">&#9670;&nbsp;</a></span>unsubscribe_kbc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() unsubscribe_kbc </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubscribes keyboard's interrupts. </p>
<p>Unsubscribes keyboard's interrupt notifications using sys_irqrmpolicy().</p>
<dl class="section return"><dt>Returns</dt><dd>0 if the operation was successful, 1 otherwise. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a1cc545950661d96524585c500b3b68d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cc545950661d96524585c500b3b68d1">&#9670;&nbsp;</a></span>data</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t data[2]</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3f07434f2f0a6a358f8342924ceb3c74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f07434f2f0a6a358f8342924ceb3c74">&#9670;&nbsp;</a></span>hookid</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int hookid = 1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa02e483eb21e700531ca2ddf2508d189"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa02e483eb21e700531ca2ddf2508d189">&#9670;&nbsp;</a></span>kbd_valid</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool kbd_valid</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a78ab698245ea1f18f4b66d2cefbfa1f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78ab698245ea1f18f4b66d2cefbfa1f1">&#9670;&nbsp;</a></span>two_byte_code</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool two_byte_code</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
