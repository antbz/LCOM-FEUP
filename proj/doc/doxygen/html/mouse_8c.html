<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LCOM-Ninja: /home/antonio/FEUP/2_ano/1_sem/LCOM/MINIX-LCOM/shared/proj/src/src/mouse.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LCOM-Ninja
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_98cdb10f369f6a3b9149e010b312bf5d.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mouse.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="mouse_8h_source.html">../headers/mouse.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for mouse.c:</div>
<div class="dyncontent">
<div class="center"><img src="mouse_8c__incl.png" border="0" usemap="#_2home_2antonio_2FEUP_22__ano_21__sem_2LCOM_2MINIX-LCOM_2shared_2proj_2src_2src_2mouse_8c" alt=""/></div>
<map name="_2home_2antonio_2FEUP_22__ano_21__sem_2LCOM_2MINIX-LCOM_2shared_2proj_2src_2src_2mouse_8c" id="_2home_2antonio_2FEUP_22__ano_21__sem_2LCOM_2MINIX-LCOM_2shared_2proj_2src_2src_2mouse_8c">
<area shape="rect" id="node2" href="mouse_8h.html" title="Functions to interface with the mouse. " alt="" coords="275,124,409,151"/>
<area shape="rect" id="node8" href="keyboard_8h.html" title="Functions to interface with the PC&#39;s keyboard controller. " alt="" coords="299,199,385,225"/>
<area shape="rect" id="node10" href="mouse__defs_8h.html" title="../headers/mouse_defs.h" alt="" coords="5,199,172,225"/>
<area shape="rect" id="node9" href="kbd__defs_8h.html" title="kbd_defs.h" alt="" coords="289,273,376,300"/>
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a757e4b5da5f470b256711c025c8f6c9e"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a757e4b5da5f470b256711c025c8f6c9e">subscribe_mouse</a> (uint8_t *bit_no)</td></tr>
<tr class="memdesc:a757e4b5da5f470b256711c025c8f6c9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Subscribes mouse's interrupts.  <a href="#a757e4b5da5f470b256711c025c8f6c9e">More...</a><br /></td></tr>
<tr class="separator:a757e4b5da5f470b256711c025c8f6c9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8f082d47fa7bde0306eb3b82b6127e9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#ad8f082d47fa7bde0306eb3b82b6127e9">enable_mouse</a> ()</td></tr>
<tr class="memdesc:ad8f082d47fa7bde0306eb3b82b6127e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enables mouse's interrupts.  <a href="#ad8f082d47fa7bde0306eb3b82b6127e9">More...</a><br /></td></tr>
<tr class="separator:ad8f082d47fa7bde0306eb3b82b6127e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22e7aa936a38417be07fc29cf34cfd05"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a22e7aa936a38417be07fc29cf34cfd05">disable_mouse</a> ()</td></tr>
<tr class="memdesc:a22e7aa936a38417be07fc29cf34cfd05"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disables mouse's interrupts.  <a href="#a22e7aa936a38417be07fc29cf34cfd05">More...</a><br /></td></tr>
<tr class="separator:a22e7aa936a38417be07fc29cf34cfd05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa228574f5c512312c12da4637d3abb45"><td class="memItemLeft" align="right" valign="top">int()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#aa228574f5c512312c12da4637d3abb45">unsubscribe_mouse</a> ()</td></tr>
<tr class="memdesc:aa228574f5c512312c12da4637d3abb45"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsubscribes mouse's interrupts.  <a href="#aa228574f5c512312c12da4637d3abb45">More...</a><br /></td></tr>
<tr class="separator:aa228574f5c512312c12da4637d3abb45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82f07d6118c32948ba44ced307f66748"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a82f07d6118c32948ba44ced307f66748">mouse_get_status_byte</a> (uint8_t *status)</td></tr>
<tr class="memdesc:a82f07d6118c32948ba44ced307f66748"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads the mouse state.  <a href="#a82f07d6118c32948ba44ced307f66748">More...</a><br /></td></tr>
<tr class="separator:a82f07d6118c32948ba44ced307f66748"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed4404005e4c565ac36656307386e0ac"><td class="memItemLeft" align="right" valign="top">void()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#aed4404005e4c565ac36656307386e0ac">mouse_ih</a> (void)</td></tr>
<tr class="memdesc:aed4404005e4c565ac36656307386e0ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mouse interrupt handler.  <a href="#aed4404005e4c565ac36656307386e0ac">More...</a><br /></td></tr>
<tr class="separator:aed4404005e4c565ac36656307386e0ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30e8c7c85734629add7c3fa01006a904"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a30e8c7c85734629add7c3fa01006a904">assemble_packet</a> (struct packet *<a class="el" href="proj_8c.html#a26e83eca70c2b9169fbbb0eac7e32e32">pp</a>)</td></tr>
<tr class="memdesc:a30e8c7c85734629add7c3fa01006a904"><td class="mdescLeft">&#160;</td><td class="mdescRight">Assembles the 3-byte data packet.  <a href="#a30e8c7c85734629add7c3fa01006a904">More...</a><br /></td></tr>
<tr class="separator:a30e8c7c85734629add7c3fa01006a904"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a3721c1f7166d799c22092fdb38ec00"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a2a3721c1f7166d799c22092fdb38ec00">mouse_cmd_write</a> (uint8_t command)</td></tr>
<tr class="memdesc:a2a3721c1f7166d799c22092fdb38ec00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes command.  <a href="#a2a3721c1f7166d799c22092fdb38ec00">More...</a><br /></td></tr>
<tr class="separator:a2a3721c1f7166d799c22092fdb38ec00"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a26e83eca70c2b9169fbbb0eac7e32e32"><td class="memItemLeft" align="right" valign="top">struct packet&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a26e83eca70c2b9169fbbb0eac7e32e32">pp</a></td></tr>
<tr class="separator:a26e83eca70c2b9169fbbb0eac7e32e32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50507d167542968dafdd0837cca1f2d6"><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mouse_8c.html#a50507d167542968dafdd0837cca1f2d6">mouse_counter</a> = 0</td></tr>
<tr class="separator:a50507d167542968dafdd0837cca1f2d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a30e8c7c85734629add7c3fa01006a904"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30e8c7c85734629add7c3fa01006a904">&#9670;&nbsp;</a></span>assemble_packet()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void assemble_packet </td>
          <td>(</td>
          <td class="paramtype">struct packet *&#160;</td>
          <td class="paramname"><em>pp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Assembles the 3-byte data packet. </p>
<p>Fills each field in the struct packet with the correct byte/bit from the bytes received</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pp</td><td>pointer to the struct packet to store the received information </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a22e7aa936a38417be07fc29cf34cfd05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22e7aa936a38417be07fc29cf34cfd05">&#9670;&nbsp;</a></span>disable_mouse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int disable_mouse </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disables mouse's interrupts. </p>
<p>Disables interrupts on the mouse IRQ line (associated with the specified hook_id) by calling function sys_irqdisable().</p>
<dl class="section return"><dt>Returns</dt><dd>value returned by sys_irqdisable(). </dd></dl>

</div>
</div>
<a id="ad8f082d47fa7bde0306eb3b82b6127e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8f082d47fa7bde0306eb3b82b6127e9">&#9670;&nbsp;</a></span>enable_mouse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int enable_mouse </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enables mouse's interrupts. </p>
<p>Enables interrupts on the mouse IRQ line (associated with the specified hook_id) by calling function sys_irqenable().</p>
<dl class="section return"><dt>Returns</dt><dd>value returned by sys_irqenable(). </dd></dl>

</div>
</div>
<a id="a2a3721c1f7166d799c22092fdb38ec00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a3721c1f7166d799c22092fdb38ec00">&#9670;&nbsp;</a></span>mouse_cmd_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mouse_cmd_write </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>command</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes command. </p>
<p>Reads the status byte to check if the input buffer is full, if not writes command 0xD4 to the kbc command register. Checks input buffer again and then writes the command byte to port 0x60. Re-sends command if failed in one byte, halts execution if there was an error in two consecutive bytes</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">command</td><td>command byte to be written. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the operation was successful, 1 otherwise (-1 if there was an error) </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mouse_8c_a2a3721c1f7166d799c22092fdb38ec00_cgraph.png" border="0" usemap="#mouse_8c_a2a3721c1f7166d799c22092fdb38ec00_cgraph" alt=""/></div>
<map name="mouse_8c_a2a3721c1f7166d799c22092fdb38ec00_cgraph" id="mouse_8c_a2a3721c1f7166d799c22092fdb38ec00_cgraph">
<area shape="rect" id="node2" href="mouse_8c.html#a82f07d6118c32948ba44ced307f66748" title="Reads the mouse state. " alt="" coords="181,5,343,32"/>
<area shape="rect" id="node3" href="utils_8c.html#a79a031a8611f5b2d6afa4158e92b0fb4" title="util_sys_inb" alt="" coords="391,31,481,57"/>
</map>
</div>

</div>
</div>
<a id="a82f07d6118c32948ba44ced307f66748"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82f07d6118c32948ba44ced307f66748">&#9670;&nbsp;</a></span>mouse_get_status_byte()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mouse_get_status_byte </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>status</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads the mouse state. </p>
<p>Reads the byte in the status register (port 0x64) and writes it to uint8_t* status</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">status</td><td>pointer to where to store the status byte read </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the operation was successful, 1 otherwise </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mouse_8c_a82f07d6118c32948ba44ced307f66748_cgraph.png" border="0" usemap="#mouse_8c_a82f07d6118c32948ba44ced307f66748_cgraph" alt=""/></div>
<map name="mouse_8c_a82f07d6118c32948ba44ced307f66748_cgraph" id="mouse_8c_a82f07d6118c32948ba44ced307f66748_cgraph">
<area shape="rect" id="node2" href="utils_8c.html#a79a031a8611f5b2d6afa4158e92b0fb4" title="util_sys_inb" alt="" coords="215,5,305,32"/>
</map>
</div>

</div>
</div>
<a id="aed4404005e4c565ac36656307386e0ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed4404005e4c565ac36656307386e0ac">&#9670;&nbsp;</a></span>mouse_ih()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void() mouse_ih </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mouse interrupt handler. </p>
<p>Reads the mouse status byte and checks if there is data available for reading. If so, reads the byte in the output buffer and stores it in the correct byte of the 3-byte data packet </p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mouse_8c_aed4404005e4c565ac36656307386e0ac_cgraph.png" border="0" usemap="#mouse_8c_aed4404005e4c565ac36656307386e0ac_cgraph" alt=""/></div>
<map name="mouse_8c_aed4404005e4c565ac36656307386e0ac_cgraph" id="mouse_8c_aed4404005e4c565ac36656307386e0ac_cgraph">
<area shape="rect" id="node2" href="mouse_8c.html#a82f07d6118c32948ba44ced307f66748" title="Reads the mouse state. " alt="" coords="132,5,293,32"/>
<area shape="rect" id="node3" href="utils_8c.html#a79a031a8611f5b2d6afa4158e92b0fb4" title="util_sys_inb" alt="" coords="341,31,432,57"/>
</map>
</div>

</div>
</div>
<a id="a757e4b5da5f470b256711c025c8f6c9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a757e4b5da5f470b256711c025c8f6c9e">&#9670;&nbsp;</a></span>subscribe_mouse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() subscribe_mouse </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>bit_no</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Subscribes mouse's interrupts. </p>
<p>Subscribes mouse's interrupt notifications using sys_irqsetpolicy().</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bit_no</td><td>pointer to the hook_id returned by the kernel in sys_irqsetpolicy(). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 if the operation was successful, 1 otherwise </dd></dl>

</div>
</div>
<a id="aa228574f5c512312c12da4637d3abb45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa228574f5c512312c12da4637d3abb45">&#9670;&nbsp;</a></span>unsubscribe_mouse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int() unsubscribe_mouse </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubscribes mouse's interrupts. </p>
<p>Unsubscribes mouse's interrupt notifications using sys_irqrmpolicy().</p>
<dl class="section return"><dt>Returns</dt><dd>0 if the operation was successful, 1 otherwise. </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="mouse_8c_aa228574f5c512312c12da4637d3abb45_cgraph.png" border="0" usemap="#mouse_8c_aa228574f5c512312c12da4637d3abb45_cgraph" alt=""/></div>
<map name="mouse_8c_aa228574f5c512312c12da4637d3abb45_cgraph" id="mouse_8c_aa228574f5c512312c12da4637d3abb45_cgraph">
<area shape="rect" id="node2" href="mouse_8c.html#a82f07d6118c32948ba44ced307f66748" title="Reads the mouse state. " alt="" coords="192,5,353,32"/>
<area shape="rect" id="node3" href="utils_8c.html#a79a031a8611f5b2d6afa4158e92b0fb4" title="util_sys_inb" alt="" coords="401,31,492,57"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a50507d167542968dafdd0837cca1f2d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50507d167542968dafdd0837cca1f2d6">&#9670;&nbsp;</a></span>mouse_counter</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned mouse_counter = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a26e83eca70c2b9169fbbb0eac7e32e32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26e83eca70c2b9169fbbb0eac7e32e32">&#9670;&nbsp;</a></span>pp</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct packet pp</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
